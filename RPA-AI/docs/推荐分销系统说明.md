# 推荐分销系统说明文档

## 1. 系统概述

本推荐分销系统是一个完整的多级分销解决方案，支持三级分销架构、动态佣金比例、推荐奖励和成就系统。系统设计注重公平性和激励性，通过多重奖励机制促进用户增长。

## 2. 核心功能

### 2.1 分销体系
- 三级分销结构
- 动态佣金比例
- 推荐人数要求
- 活跃度考核

### 2.2 奖励机制
- 推荐奖励
- 成就奖励
- 等级奖励
- 活动奖励

## 3. 分销等级

### 3.1 等级体系
```json
{
    "level_1": {
        "commission_rate": 0.15,
        "requirements": {
            "min_referrals": 2,
            "min_active_users": 1
        }
    },
    "level_2": {
        "commission_rate": 0.10,
        "requirements": {
            "min_referrals": 5,
            "min_active_users": 3
        }
    },
    "level_3": {
        "commission_rate": 0.05,
        "requirements": {
            "min_referrals": 10,
            "min_active_users": 5
        }
    }
}
```

### 3.2 晋升条件
- 推荐人数要求
- 活跃用户数量
- 业绩指标
- 时间要求

## 4. 佣金规则

### 4.1 佣金计算
- 一级：15%
- 二级：10%
- 三级：5%

### 4.2 额外奖励
- 首次推荐：50积分
- 达成5人：100积分
- 月度达标：200积分
- 年度达标：1000积分

## 5. 使用说明

### 5.1 推荐处理
```python
referral_service = ReferralService()

# 处理推荐关系
result = await referral_service.process_referral(
    referrer_id="user123",
    referee_id="new_user456"
)

# 计算佣金
commission = await referral_service.calculate_commission(
    referrer_id="user123",
    order_amount=1000.00
)

# 获取统计数据
stats = await referral_service.get_referral_stats(
    user_id="user123"
)
```

### 5.2 接口调用
```python
# 创建推荐关系
POST /api/referral/create
{
    "referrer_id": "user123",
    "referee_id": "new_user456"
}

# 查询佣金
GET /api/referral/commission/{user_id}

# 获取统计数据
GET /api/referral/stats/{user_id}
```

## 6. 数据管理

### 6.1 推荐记录
- 推荐关系
- 时间戳
- 状态信息
- 奖励记录

### 6.2 佣金记录
- 订单信息
- 佣金金额
- 结算状态
- 支付记录

### 6.3 统计数据
- 推荐人数
- 活跃用户
- 总佣金额
- 待结算额

## 7. 安全措施

### 7.1 风控管理
- 身份验证
- 关系验证
- 活跃度检查
- 异常监控

### 7.2 数据安全
- 加密存储
- 访问控制
- 操作日志
- 数据备份

## 8. 最佳实践

### 8.1 推荐策略
1. 设置合理门槛
   - 最少2人起
   - 考核活跃度
   - 限制推荐数
   - 设置冷却期

2. 奖励机制
   - 即时奖励
   - 长期激励
   - 阶梯提升
   - 特殊奖励

### 8.2 运营建议
- 定期活动
- 等级特权
- 成就体系
- 社区运营

## 9. 常见问题

### 9.1 问题处理
1. 佣金计算
   - 检查等级
   - 验证条件
   - 确认比例
   - 核对记录

2. 推荐关系
   - 验证有效性
   - 检查重复
   - 确认资格
   - 更新状态

### 9.2 系统维护
- 数据清理
- 规则更新
- 性能优化
- 安全检查

## 10. 更新日志

### v1.0.0 (2025-03-18)
- 三级分销架构
- 动态佣金计算
- 推荐奖励系统
- 数据统计分析

## 11. 未来规划

### 11.1 功能扩展
- 团队奖励
- 任务系统
- 积分商城
- 社交分享

### 11.2 系统优化
- 实时统计
- 智能推荐
- 自动结算
- 报表系统
